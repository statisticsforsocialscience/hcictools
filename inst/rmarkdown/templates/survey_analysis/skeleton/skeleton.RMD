---
title: "Untitled"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
    theme: default
    includes:
      before_body: doc_prefix.html
      after_body: doc_suffix.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Here the dependencies of this template are listed. You may add further libraries here
deps <- c("tidyverse",    # The tidyverse infrastructure
          "stringr",      # Getting numerics from strings
          "hcictools",    # The functions from the package this
          "haven",        # SPSS File handling
          "here",         # Relative file paths
          "psych",        # Exploratory Factor analysis and reliability methods
          "apaTables",    # Formatting tables in APA standard
          "xtable",       # printing Tables for a nice summary
          "sjlabelled")   # Methods for handling labelled data (such as SPSS files)

# The following code is never executed, as it is bad style to install packages from code.
# If you still want to install the required packages, go here if you want to install the dependencies
if(FALSE){
  install.packages(deps)
  install.packages("devtools")
  library(devtools)
  devtools::install_github("HCIC/r-tools")
}

# Actually loads all dependencies using the require method.
lapply(deps, require, character.only = TRUE)
```

# First Chapter Using Tabs {.tabset .tabset-fade .tabset-pills}
## Subsection 1.1
## Subsection 1.2

# Second Chapter
## Subsection 2

# How to use this template

## Examples

### Loading data
```{r loading_data}
# insert SPSS filename here
data_filename <- "datafiles/" 
raw <- read_sav(data_filename)
```

### Renaming variable
```{r renaming_variables}

# select the relevant columns, we have four examples of how to select variables
raw_shorlist <- raw %>% select(starts_with("q"), #use all variables that start with q
                               starts_with("p"), # and p
                               -num_range("q",4:6, width=4), # remove q0004 to q0006
                               -starts_with("q0007") 
                               )

# rename individual variables and rename a set of variables, here: q002_*****
data <- raw_shorlist %>% rename (gender = q0001) %>% 
  rename_at(vars( contains("q002_") ), funs( paste0("shopping_behavior", 1:5 ) ) )
```

### Adjust variable levels
```{r adjust_variables}

# creates a factor variable and copies the surveymonkey labels
data$gender <- sjlabelled::as_factor(data$gender, add.non.labelled = TRUE)
# adjust levels, e.g., translation
levels(data$gender) <- c("male","female")


# get the first number from an age field 

test <- "hallo 123"
data$age <- as_numeric(str_extract_all(data$age, "[0-9]+")[[1]])
as_numeric(test)
```

### Assigning items to factors

## Factor Analysis

### Confirmatory Factor Analysis using lavaan
```{r lavaan}
library(lavaan)
d <- read_delim("../../../../../../hcictools/data/data.csv", delim = "\t")


names(d) <- tolower(names(d))

d

model <- "agree =~ a1 + a2 +a3
con =~ c1 + c2 + c3
extra =~ e1 + e2 + e3
"

cat(model)

fit <- cfa(model, d)
fit
summary(fit)
parameterestimates(fit, standardized = T)
fitmeasures(fit, fit.measures = c("cfi","chisq", "df", "rmsea",  "srmr"))

inspect(fit, "r2")

library(semPlot)
```

### Path Modeling using semPLS

```{r semPLSExample}
library(semPLS)


```






# Descriptive Statistics

```{r}
summary(data)


```















